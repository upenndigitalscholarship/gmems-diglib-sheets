<!doctype html>
<html lang="en" class="h-100">
  <head prefix="og: http://ogp.me/ns#">
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Collection Item | Global Medieval and Early Modern Digital Library (GMEMS)</title>
<link rel="shortcut icon" type="image/x-icon" href="/gmems-diglib-sheets/favicon.ico">
<!--
  _____     ____        __  _           ___       _ __   __       
 / ___/__  / / /__ ____/ /_(_)__  ___  / _ )__ __(_) /__/ /__ ____
/ /__/ _ \/ / / -_) __/ __/ / _ \/ _ \/ _  / // / / / _  / -_) __/
\___/\___/_/_/\__/\__/\__/_/\___/_//_/____/\_,_/_/_/\_,_/\__/_/   
   
    built with CollectionBuilder-Sheets
    https://github.com/CollectionBuilder/collectionbuilder-sheets
-->
<meta name="generator" content="collectionbuilder-sheets" />
<meta http-equiv="Content-Language" content="en-us" >

<!-- load style sheets -->

<link rel="stylesheet" href="/gmems-diglib-sheets/assets/lib/bootstrap.min.css" type="text/css">


<link rel="preload" href="/gmems-diglib-sheets/assets/lib/spotlight.bundle.js" as="script">

<!-- load custom css last to allow overrides -->
<link rel="stylesheet" href="/gmems-diglib-sheets/assets/css/custom.css" type="text/css">

<meta name="robots" content="noindex">
<meta name="description" content="The Global Medieval and Early Modern Digital Library brings together translations, often accompanied by transcriptions, of primary sources encompassing a wide range of genres, regions and languages from the period between Late Antiquity and 1700. The site allows these sources to be organized by theme, region, language and date.">
<meta name="author" content="upenndigitalscholarship" >
<!-- Open Graph meta -->
<meta property="og:title" content="Collection Item | Global Medieval and Early Modern Digital Library (GMEMS)" />
<meta property="og:description" content="The Global Medieval and Early Modern Digital Library brings together translations, often accompanied by transcriptions, of primary sources encompassing a wide range of genres, regions and languages from the period between Late Antiquity and 1700. The site allows these sources to be organized by theme, region, language and date." />
<meta property="og:site_name" content="Global Medieval and Early Modern Digital Library (GMEMS)" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://upenndigitalscholarship.github.io/gmems-diglib-sheets//gmems-diglib-sheets/item.html" />
<meta property="og:locale" content="en_US" />
<!-- schema.org JSON-LD -->
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"Collection Item | Global Medieval and Early Modern Digital Library (GMEMS)","publisher":"upenndigitalscholarship","description":"The Global Medieval and Early Modern Digital Library brings together translations, often accompanied by transcriptions, of primary sources encompassing a wide range of genres, regions and languages from the period between Late Antiquity and 1700. The site allows these sources to be organized by theme, region, language and date.","url":"https://upenndigitalscholarship.github.io/gmems-diglib-sheets//gmems-diglib-sheets/item.html"}</script> 


<!-- Analytics --> 



<!-- Last build date: 2022-06-27 -->
  </head>
  <body class="d-flex flex-column h-100">
    <div id="skip-to-content"><a href="#maincontent">Skip to main content</a></div>
    <div class="container">
    <div class="row align-items-center">
        <div id="title" class="col-md-9">
            <h1><a class="text-dark font-weight-normal" href="/gmems-diglib-sheets/" >Global Medieval and Early Modern Digital Library (GMEMS)</a></h1>	 
            <p>Medieval and Early Modern texts from around the globe translated into English.</p>
        </div>
        
        <div class="col-md-3 d-none d-lg-block text-end">
            <a class="btn btn-outline-light" href="https://www.library.upenn.edu/help-with/research-data-digital-scholarship" target="_blank" rel="noopener">
                <img class="img-fluid" src="/gmems-diglib-sheets/assets/img/PennLibrariesLogo2020_BlackRGB.png" title="Center for Research Data and Digital Scholarship, Penn Libraries" alt="Center for Research Data and Digital Scholarship, Penn Libraries home" >
            </a>
        </div>
        
    </div>
</div>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#page-nav" aria-controls="page-nav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <span class="d-lg-none text-end">
            <a href="https://www.library.upenn.edu/help-with/research-data-digital-scholarship" target="_blank" rel="noopener">
                <img class="img-fluid" id="mobile-nav-image" src="/gmems-diglib-sheets/assets/img/PennLibrariesLogo2020_BlackRGB.png" title="Center for Research Data and Digital Scholarship, Penn Libraries" alt="Center for Research Data and Digital Scholarship, Penn Libraries home" >
            </a>
        </span>
        
        <div class="collapse navbar-collapse" id="page-nav">
            <ul class="navbar-nav me-auto">
                
                <li class="nav-item">
                    <a class="nav-link" href="/gmems-diglib-sheets/">Home</a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="/gmems-diglib-sheets/browse.html">Browse</a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="/gmems-diglib-sheets/subjects.html">Subjects</a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="/gmems-diglib-sheets/locations.html">Locations</a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="/gmems-diglib-sheets/map.html">Map</a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="/gmems-diglib-sheets/timeline.html">Timeline</a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="/gmems-diglib-sheets/data.html">Data</a>
                </li></ul>
            
            <script>
    function site_search() {
        var query = document.getElementById("site-search").value;
        window.open("/gmems-diglib-sheets/search/index.html?q=" + encodeURIComponent(query), "_self" );
    }
</script>
<form class="form-inline my-2 my-lg-0" role="search" id="search" onsubmit="site_search(); return false;">
    <div class="input-group">
        <input id="site-search" class="form-control " type="text" placeholder="Search" aria-label="Search box">
        <button class="btn btn-light" type="submit">
            <span id="search-icon"><svg viewBox="0 0 1024 974" height="16px" width="20px"><path d="M960 832L710.875 582.875C746.438 524.812 768 457.156 768 384 768 171.96900000000005 596 0 384 0 171.969 0 0 171.96900000000005 0 384c0 212 171.969 384 384 384 73.156 0 140.812-21.562 198.875-57L832 960c17.5 17.5 46.5 17.375 64 0l64-64C977.5 878.5 977.5 849.5 960 832zM384 640c-141.375 0-256-114.625-256-256s114.625-256 256-256 256 114.625 256 256S525.375 640 384 640z"/></svg></span>
            <span class="visually-hidden">Search</span>
        </button>
    </div>
</form>
            
        </div>
    </div>
</nav>

    <main id="maincontent" role="main" class="flex-shrink-0">
    <div class="container mt-2 mb-4">
    <ul class="breadcrumb h6">
        <li class="breadcrumb-item"><a class="text-dark" href="/gmems-diglib-sheets/">Global Medieval and Early Modern Digital Library (GMEMS)</a></li>
        <li class="breadcrumb-item"><a class="text-dark" href="/gmems-diglib-sheets/browse.html">Browse</a></li>
        <li id="bc-title" class="breadcrumb-item active text-dark" aria-current="page"></li>
    </ul>

    <h2 id="item-title"></h2>

    <div id="loading" class="text-center">
        <div class="spinner-border text-secondary" role="status"><span class="visually-hidden">Loading...</span></div>
    </div>

    <h2>  </h2>
    
    <div class="line-translation_nos">
        <div class="left">
            <h4> Transcription </h4>
            <pre class="textbox" id="original-text"></pre>
        </div>
        <div class="right">
            <h4> Translation </h4>
            <pre class="textbox" id="translated-text"></pre>
        </div>
    </div>

    <div class="row mt-3">

        <div class="col-md-6" >
            <div class="card mb-4 text-center">
                <div class="w-100 text-center p-1" id="item-image"></div>
                <div id="item-link" class="text-center my-2"></div>
            </div>
        </div>
        <div class="col-md-6">
            <div id="item-metadata" class="metadata">
            </div>
        </div> 
    </div><div class="text-center">
        <a id="prev-button" class="btn btn-secondary">&laquo; Previous</a>
        <a class="btn btn-secondary" href="/gmems-diglib-sheets/browse.html">Back to browse</a>
        <a id="for-button" class="btn btn-secondary">Next &raquo;</a>
    </div>

    <div id="item-nav">
        <div class="d-none d-md-block">
            <a id="back-button" class="previous btn btn-lg btn-secondary">&laquo;</a>
            <a id="next-button" class="next btn btn-lg btn-secondary">&raquo;</a>
        </div>
    </div>
    
</div>

    </main>
    <footer class="bg-light pt-4 mt-auto container-fluid">

    <div class="row border-bottom border-white pb-4 mb-2">

        <div class="col-md-7 px-4 mt-2">

            <h4><a href="/gmems-diglib-sheets/" class="text-black font-weight-normal">Global Medieval and Early Modern Digital Library (GMEMS)</a></h4>
            <p class="text-black"><small>Medieval and Early Modern texts from around the globe translated into English.</small></p>
<!--            <nav>
                <ul id="footer-nav" class="nav nav-pills ">
                    <li class="nav-item">
                    
                        <a class="nav-link text-light" href="/gmems-diglib-sheets/">Home</a>
                    </li>
                    <li class="nav-item">
                    
                        <a class="nav-link text-light" href="/gmems-diglib-sheets/browse.html">Browse</a>
                    </li>
                    <li class="nav-item">
                    
                        <a class="nav-link text-light" href="/gmems-diglib-sheets/subjects.html">Subjects</a>
                    </li>
                    <li class="nav-item">
                    
                        <a class="nav-link text-light" href="/gmems-diglib-sheets/locations.html">Locations</a>
                    </li>
                    <li class="nav-item">
                    
                        <a class="nav-link text-light" href="/gmems-diglib-sheets/map.html">Map</a>
                    </li>
                    <li class="nav-item">
                    
                        <a class="nav-link text-light" href="/gmems-diglib-sheets/timeline.html">Timeline</a>
                    </li>
                    <li class="nav-item">
                    
                        <a class="nav-link text-light" href="/gmems-diglib-sheets/data.html">Data</a>
                    </li></ul>
            </nav>
        </div>

        <div class="col-md-5 mt-2 text-end">

            <p class="text-end">
                <a href="https://www.library.upenn.edu/help-with/research-data-digital-scholarship" target="_blank" rel="noopener">
                    <img id="footer-logo" class="img-fluid" src="/gmems-diglib-sheets/assets/img/PennLibrariesLogo2020_BlackRGB.png" alt="Center for Research Data and Digital Scholarship, Penn Libraries home">
                </a>
            </p>
            
            <p class="text-black" id="footer-credits">
                <small><em>built with</em>
                    <a href="https://collectionbuilder.github.io/" target="_blank" rel="noopener" title="CollectionBuilder">
                        <img src="/gmems-diglib-sheets/assets/img/collectionbuilder-logo.png" class="img-fluid" alt="CollectionBuilder logo" >
                    </a>
                </small>
            </p>

        </div>

    </div>

    <div class="col-md-12 text-center pt-3 pb-1">
        <p class="text-black">Last updated 2022</p>
    </div>

</footer>
    <!-- Bootstrap bundle JS -->
<script src="/gmems-diglib-sheets/assets/lib/bootstrap.bundle.min.js"></script>
<!-- load other js -->
<script src="/gmems-diglib-sheets/assets/lib/lazysizes.min.js" async></script>
<script src="/gmems-diglib-sheets/assets/lib/papaparse.min.js"></script>
<script src="/gmems-diglib-sheets/assets/lib/spotlight.bundle.js" defer></script>
<script>
/* function to display item */
function displayItem(record, prev_id, next_id) {

    /* add item title */
    var objectTitle = record.title;
    document.getElementById("bc-title").innerHTML = objectTitle;
    document.getElementById("item-title").innerHTML = objectTitle;
    /* add object */ 
    var format = "" + record.format;
    if(record.filename) { 
        if (record.filename.includes("/")) { 
            var objectSrc = record.filename; 
        } else { 
            var objectSrc = "/gmems-diglib-sheets/objects/" + record.filename; 
        }
    }
    //check for pdf url
    if(record.pdf_url) { 
        if (record.pdf_url.includes("/")) { 
            var objectSrc = record.pdf_url; 
        } else { 
            var objectSrc = "/gmems-diglib-sheets/objects/" + record.filename; 
        }
    }
    var itemImage, itemLink;

    if (format.includes('image')) {
        itemImage= '<div class="spotlight gallery-img" data-download="true" data-src="' + objectSrc + '"><img class="img-fluid" src="' + objectSrc + '" alt="' + objectTitle + '"><p><small>Click to view full screen</small></p></div>';
        itemLink= '<a href="' + objectSrc + '" target="_blank" class="m-2 btn btn-dark" title="Object download">Download Image</a>';
    } else if (format.includes('pdf')) {
        itemImage= '<object aria-label="' + objectTitle + '" data="' + objectSrc + '" type="application/pdf" width="100%" height="450px"><p>The PDF is not rendering in your browser. Please use the button below to download the PDF.</p></object>';
        itemLink= '<a href="' + objectSrc + '" target="_blank" class="m-2 btn btn-dark" title="Object download">Download PDF</a>';
    } else if (format.includes('audio')) {
        itemImage= '<audio controls class="w-100"><source src="' + objectSrc + '">Your browser does not support the audio element.</audio>';
        itemLink= '<a href="' + objectSrc + '" target="_blank" class="m-2 btn btn-dark" title="Object download">Download Audio File</a>';
    } else if (record.youtubeid) {
        itemImage= '<div class="ratio ratio-16x9"><iframe title="' + objectTitle + '" src="https://www.youtube-nocookie.com/embed/' + record.youtubeid + '?rel=0&modestbranding=1" allowfullscreen></iframe></div>';
        itemLink= '<a href="https://youtu.be/' + record.youtubeid + '" target="_blank" class="m-2 btn btn-dark" title="Object download">View on YouTube</a>';
    } else if (record.vimeoid) {
        itemImage= '<div class="ratio ratio-16x9"><iframe title="' + objectTitle + '" src="https://player.vimeo.com/video/' + record.vimeoid + '" allowfullscreen></iframe></div>';
        itemLink= '<a href="https://vimeo.com/' + record.vimeoid + '" target="_blank" class="m-2 btn btn-dark" title="Object download">View on Vimeo</a>';
    } else if (format.includes('video')) {
        itemImage= '<video controls class="w-100"><source src="' + objectSrc + '">Your browser does not support the video element.</audio>';
        itemLink= '<a href="' + objectSrc + '" target="_blank" class="m-2 btn btn-dark" title="Object download">Download Video File</a>';
    } else {
        /* fall back to no preview if it doesn't know the format */
        itemImage= '<img class="w-50" src="/gmems-diglib-sheets/assets/lib/icons/file-earmark.svg" alt="No preview found">';
        itemLink= '<a href="' + objectSrc + '" target="_blank" class="m-2 btn btn-dark" title="Object download">Download Object</a>';
    }

    
    /* add link to view on timeline */
    if (record.date) {
        var itemYear;
        if (record.date.includes('-')) {
            itemYear = record.date.split('-')[0];
        } else if (record.date.includes('/')) {
            itemYear = record.date.split('/').pop();
        } else {
            itemYear = record.date;
        }
        itemLink += '<a href="/gmems-diglib-sheets/timeline.html#y' + itemYear + '" class="m-2 btn btn-outline-dark">View on Timeline</a>';
    }
    /* add link to view on map */ 
    if (record.latitude && record.longitude) {
        itemLink += '<a href="/gmems-diglib-sheets/map.html#' + record.latitude + ',' + record.longitude + '" class="m-2 btn btn-outline-dark">View on Map</a>';
    }/* add content to item display area */
    document.getElementById("item-image").innerHTML = itemImage;
    document.getElementById("item-link").innerHTML = itemLink;
    
    /* add item metadata */
    var fields = '<dl>';
    if (record["title_orig"]) {
        console.log("title_orig");
         fields += '<dt class="field">Title:</dt> <dd class="field-value">' + record["title_orig"] + '</dd>'; }
    
    
    if (record["title"]) {
        console.log("title");
         fields += '<dt class="field">Title (Translated):</dt> <dd class="field-value">' + record["title"] + '</dd>'; }
    
    
    if (record["introduction"]) {
        console.log("introduction");
         fields += '<dt class="field">Introduction:</dt> <dd class="field-value">' + record["introduction"] + '</dd>'; }
    
    
    if (record["description"]) {
        console.log("description");
         fields += '<dt class="field">Description:</dt> <dd class="field-value">' + record["description"] + '</dd>'; }
    
    
    if (record["creator"]) {
        console.log("creator");
         fields += '<dt class="field">Author:</dt> <dd class="field-value">' + record["creator"] + '</dd>'; }
    
    
    if (record["translator"]) {
        console.log("translator");
         fields += '<dt class="field">Translator:</dt> <dd class="field-value">' + record["translator"] + '</dd>'; }
    
    
    
    if (record["language"]) {
        var topics = record["language"].split(';');
        var browseLinks = "";
        for (var i = 0, len = topics.length; i < len; i++) {
            if (topics[i] != "") {
                browseLinks += '<a class="btn btn-primary" href="/gmems-diglib-sheets/browse.html#' + encodeURIComponent(topics[i].trim()) + '">' + topics[i].trim() + '</a> ';
            }
        }
        fields += '<dt class="field">Language:</dt> <dd class="field-value">' + browseLinks + '</dd>';
    }
    
    
    if (record["region"]) {
        var topics = record["region"].split(';');
        var browseLinks = "";
        for (var i = 0, len = topics.length; i < len; i++) {
            if (topics[i] != "") {
                browseLinks += '<a class="btn btn-primary" href="/gmems-diglib-sheets/browse.html#' + encodeURIComponent(topics[i].trim()) + '">' + topics[i].trim() + '</a> ';
            }
        }
        fields += '<dt class="field">Region:</dt> <dd class="field-value">' + browseLinks + '</dd>';
    }
    
    
    if (record["period"]) {
        var topics = record["period"].split(';');
        var browseLinks = "";
        for (var i = 0, len = topics.length; i < len; i++) {
            if (topics[i] != "") {
                browseLinks += '<a class="btn btn-primary" href="/gmems-diglib-sheets/browse.html#' + encodeURIComponent(topics[i].trim()) + '">' + topics[i].trim() + '</a> ';
            }
        }
        fields += '<dt class="field">Time Period:</dt> <dd class="field-value">' + browseLinks + '</dd>';
    }
    
    if (record["date"]) {
        console.log("date");
         fields += '<dt class="field">Date Created:</dt> <dd class="field-value">' + record["date"] + '</dd>'; }
    
    
    
    if (record["genre"]) {
        var topics = record["genre"].split(';');
        var browseLinks = "";
        for (var i = 0, len = topics.length; i < len; i++) {
            if (topics[i] != "") {
                browseLinks += '<a class="btn btn-primary" href="/gmems-diglib-sheets/browse.html#' + encodeURIComponent(topics[i].trim()) + '">' + topics[i].trim() + '</a> ';
            }
        }
        fields += '<dt class="field">Genre:</dt> <dd class="field-value">' + browseLinks + '</dd>';
    }
    
    
    if (record["subject"]) {
        var topics = record["subject"].split(';');
        var browseLinks = "";
        for (var i = 0, len = topics.length; i < len; i++) {
            if (topics[i] != "") {
                browseLinks += '<a class="btn btn-primary" href="/gmems-diglib-sheets/browse.html#' + encodeURIComponent(topics[i].trim()) + '">' + topics[i].trim() + '</a> ';
            }
        }
        fields += '<dt class="field">Subjects:</dt> <dd class="field-value">' + browseLinks + '</dd>';
    }
    
    if (record["location"]) {
        console.log("location");
         fields += '<dt class="field">Location:</dt> <dd class="field-value">' + record["location"] + '</dd>'; }
    
    
    if (record["latitude"]) {
        console.log("latitude");
         fields += '<dt class="field">Latitude:</dt> <dd class="field-value">' + record["latitude"] + '</dd>'; }
    
    
    if (record["longitude"]) {
        console.log("longitude");
         fields += '<dt class="field">Longitude:</dt> <dd class="field-value">' + record["longitude"] + '</dd>'; }
    
    
    if (record["identifier"]) {
        console.log("identifier");
         fields += '<dt class="field">Source Identifier:</dt> <dd class="field-value">' + record["identifier"] + '</dd>'; }
    
    
    if (record["type"]) {
        console.log("type");
         fields += '<dt class="field">Type:</dt> <dd class="field-value">' + record["type"] + '</dd>'; }
    
    
    if (record["format"]) {
        console.log("format");
         fields += '<dt class="field">Format:</dt> <dd class="field-value">' + record["format"] + '</dd>'; }
    
    
    if (record["rightsstatement"]) {
        console.log("rightsstatement");
         fields += '<dt class="field">:</dt> <dd class="field-value">' + record["rightsstatement"] + '</dd>'; }
    
    
    if (record["source"]) {
        console.log("source");
         fields += '<dt class="field">Source:</dt> <dd class="field-value">' + record["source"] + '</dd>'; }
    
    
    if (record["endnotes"]) {
        console.log("endnotes");
         fields += '<dt class="field">References:</dt> <dd class="field-value">' + record["endnotes"] + '</dd>'; }
    
    
    
    fields += '</dl>';
    document.getElementById("item-metadata").innerHTML = fields;

    /* add the original + translated text from the data to the correct divs */

    document.getElementById("original-text").innerHTML = record.orig_text;
    document.getElementById("translated-text").innerHTML = record.trans_text;

/* listen for textbox class and apply css formatting to original + translated text divs */

window.addEventListener("load", function () {
    var codes = document.getElementsByClassName("textbox");
    for (var i = 0; i < codes.length; i++) {
        lineToSpan(codes[i]);
    }
  }, false);
  function lineToSpan (code) {
    var lines = code.innerHTML.split("\n");
    while(code.childNodes.length > 0) {
        code.removeChild(code.childNodes[0]);
    }
    for(var i = 0; i < lines.length; i++) {
        var span = document.createElement("span");
        span.className = "line";
        span.innerHTML = lines[i];
        code.appendChild(span);
        code.appendChild(document.createTextNode("\n"));
    }
  };

    
    if (prev_id) {
        /* add prev/next nav */
        var backUrl = "/gmems-diglib-sheets/item.html?id=" + prev_id;
        var forwardUrl = "/gmems-diglib-sheets/item.html?id=" + next_id;
        /* add side buttons to page */
        document.getElementById("back-button").href = backUrl;
        document.getElementById("next-button").href = forwardUrl;
        /* add bottom buttons to page */
        document.getElementById("prev-button").href = backUrl;
        document.getElementById("for-button").href = forwardUrl;

        /* add back forward key press */
        document.onkeydown = function(evt) {
        evt = evt || window.event;
        switch (evt.keyCode) {
            case 37:
            location.href = backUrl;
                break;
            case 39:
            location.href = forwardUrl;
                break;
        }};
    }}

/* function to init page after loading items */
function pageInit(items) {

    /* get query id from URL */
    var queryString = window.location.search.substring(1).split("=")[1];
    /* find related item by objectid */
    var record_index = items.findIndex(item => item.objectid == queryString); 

    // display if item exists
    if (record_index != -1) {
        
        // find next and previous record
        var last = items.length - 1;
        var prev_id, next_id;
        if (record_index === 0) {
            prev_id = items[last].objectid;
        } else { 
            prev_id = items[record_index - 1].objectid;
        }
        if (record_index === last) {
            next_id = items[0].objectid;
        } else {
            next_id = items[record_index + 1].objectid;
        }
        displayItem(items[record_index], prev_id, next_id);
    } else {
        /* no item with that ID */
        document.getElementById("bc-title").innerHTML = 'Not found?';
        document.getElementById("item-title").innerHTML = 'Sorry, item not found. Please visit <a href="/gmems-diglib-sheets/browse.html">Browse page</a> to find an item.';
    }
    /* all done, so hide loading animation */
    document.getElementById("loading").style.display = "none";
}

/* Load items from Sheets, store in sessionStorage, or load from sessionStorage */
var cb_items = [];
var config_metadata = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQBf-Kju6JGQkO1ibauCi6tWo3EJuPuPwLELw5o7L7sX-Mr8ZRonQAFbGA4xgOMwOU15KlO3Nh73pC5/pub?gid=1778110557&single=true&output=csv";

// function to process items from Sheets and store
function cb_items_init(metadata_url) {
  /* use papaparse to get metadata from configured CSV URL, then init page */
  Papa.parse(metadata_url, {
    download: true,
    header: true,
    complete: (results) => { 
      cb_items = results.data.filter(item => item["objectid"]);
      sessionStorage.setItem("cb_items_store", JSON.stringify(cb_items));
      pageInit(cb_items);
    },
    error: (err) => {
      alert("There is an error parsing your CSV! Please check the configured URL or file. The most common issue is incorrect filename, path, or URL so that your CSV is not found.");
    }
  });
}

// check for sessionStored items
if (sessionStorage.getItem("cb_items_store")) {
  cb_items = JSON.parse(sessionStorage.getItem("cb_items_store"));
  pageInit(cb_items);

} else if (sessionStorage.getItem("cb_metadata_set") && sessionStorage.getItem("cb_metadata_set").includes("https://")) {
  cb_items_init(sessionStorage.getItem("cb_metadata_set"));
} else if (config_metadata != "") { 
  cb_items_init(config_metadata);
} else {
  // if no CSV is configured, add a warning alert
  var metadataAlert = document.createElement("div");
  metadataAlert.classList.add("container");
  metadataAlert.innerHTML = `<div class="alert alert-warning mt-3 text-center h3" role="alert">
    This site has no metadata set in "_config.yml"<br> please <a href="/gmems-diglib-sheets/setup/" class="alert-link">visit the setup page</a> to configure!
  </div>`;
  document.querySelector("main").prepend(metadataAlert);
}


if (sessionStorage.getItem("cb_metadata_set")) { 
  var refreshButton = document.createElement("div");
  refreshButton.classList.add("dev-buttons");
  refreshButton.innerHTML = `<div class="btn-group-vertical">
    ${ sessionStorage.getItem("cb_metadata_set").includes("https://") ? '<button class="btn btn-sm btn-info" onclick="refreshMetadata()" id="refreshButton">Refresh Metadata</button>' : '' }
    <a class="btn btn-sm btn-warning" href="/gmems-diglib-sheets/setup/">Change Metadata</a>
    <button class="btn btn-sm btn-secondary" onclick="resetMetadata()" id="refreshButton">Reset</button>
    </div>`;
  document.body.appendChild(refreshButton);
  function refreshMetadata () {
    // remove data
    sessionStorage.removeItem("cb_items_store");
    // reload
    location.reload();
  }
  function resetMetadata () {
    // remove data
    sessionStorage.removeItem("cb_items_store");
    sessionStorage.removeItem("cb_metadata_set");
    // reload
    location.reload();
  }
}

</script>


    <script>
    // When the user scrolls down from the top of the document, show the button
    window.onscroll = function () {
        if (document.body.scrollTop > 500 || document.documentElement.scrollTop > 500) {
            document.getElementById("scroll-to-top").style.display = "block";
        } else {
            document.getElementById("scroll-to-top").style.display = "none";
        }
    }
    // scroll to top function
    function scrollToTop() {
        window.scroll({
            top: 0, 
            left: 0, 
            behavior: 'smooth'
        });
    }
</script>
<button id="scroll-to-top" type="button" class="btn btn-link btn-lg" onclick="scrollToTop();" title="Back to Top" aria-label="Back to Top">
    <svg class="bi icon-sprite" role="img" aria-label="Up Arrow">
        <use xlink:href="/gmems-diglib-sheets/assets/lib/cb-icons.svg#icon-back-to-top"/>
    </svg>
</button>

  </body>
</html>